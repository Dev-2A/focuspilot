<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ app_name }} Â· Report</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header class="wrap header">
    <div class="brand">
      <h1>{{ app_name }}</h1>
      <p class="muted">
        <a href="/">í™ˆìœ¼ë¡œ</a>
      </p>
    </div>

    <!-- v0.2: ë‚ ì§œ ì„ íƒ -->
    <div class="reportControls">
      <form class="reportForm" method="get" action="/report">
        <input class="dateInput" type="date" name="date" value="{{ date }}" />
        <input type="hidden" name="range" value="day" />
        <button class="btn btnSoft btnFixed" type="submit">ì¼ê°„ ë³´ê¸°</button>
      </form>

      <form class="reportForm" method="get" action="/report">
        <input class="dateInput" type="date" name="date" value="{{ date }}" />
        <input type="hidden" name="range" value="week" />
        <button class="btn btnSoft btnFixed" type="submit">ì£¼ê°„ ë³´ê¸°</button>
      </form>

      <div class="reportQuick">
        <a class="pill" href="/report?date={{ date }}&range=day">Today</a>
        <a class="pill" href="/report?date={{ (date | replace(date[8:10], (date[8:10] | int - 1) | string)) }}&range=day" style="display:none;"></a>
        <!-- ìœ„ 'Yesterday'ëŠ” í…œí”Œë¦¿ì—ì„œ ë‚ ì§œ ê³„ì‚°ì´ ì• ë§¤í•´ì„œ JS ì—†ì´ ìˆ¨ê¹€ ì²˜ë¦¬.
             í•„ìš”í•˜ë©´ run.pyì—ì„œ yesterday ë§í¬ë¥¼ ë‚´ë ¤ì£¼ë„ë¡ ë°”ê¿€ ìˆ˜ ìˆì–´. -->
      </div>
    </div>
  </header>

  <main class="wrap grid">
    <!-- Summary -->
    <section class="card">
      <div class="cardHead">
        <h2>{% if mode == "week" %}ì£¼ê°„ ìš”ì•½{% else %}ì¼ê°„ ìš”ì•½{% endif %}</h2>
        <span class="pill">{{ date }}</span>
      </div>

      <div class="summaryGrid">
        <div class="summaryItem">
          <div class="muted small">ì§‘ì¤‘ ì‹œê°„</div>
          <div class="summaryValue">{{ summary.focus_min }}ë¶„</div>
        </div>
        <div class="summaryItem">
          <div class="muted small">ì„¸ì…˜ ìˆ˜</div>
          <div class="summaryValue">{{ summary.session_count }}</div>
        </div>
        <div class="summaryItem">
          <div class="muted small">ë°©í•´ìš”ì†Œ</div>
          <div class="summaryValue">{{ summary.distractions }}</div>
        </div>
        <div class="summaryItem">
          <div class="muted small">ëª©í‘œ ì™„ë£Œ</div>
          <div class="summaryValue">{{ summary.goal_done }}/{{ summary.goal_total }}</div>
        </div>
      </div>

      <!-- v0.2: ëª©í‘œ ì™„ë£Œìœ¨ ê·¸ë˜í”„(ë¯¸ë‹ˆë©€ progress bar) -->
      <div class="progressWrap">
        <div class="row between">
          <span class="muted small">ëª©í‘œ ì™„ë£Œìœ¨</span>
          <b>{{ summary.goal_pct }}%</b>
        </div>
        <div class="progressBar" role="progressbar" aria-valuenow="{{ summary.goal_pct }}" aria-valuemin="0" aria-valuemax="100">
          <div class="progressFill" style="width: {{ summary.goal_pct }}%"></div>
        </div>
        <p class="muted small" style="margin:8px 0 0;">
          ëª©í‘œê°€ 0ê°œì¸ ë‚ ì€ 0%ë¡œ í‘œì‹œí•œë‹¤. (í†µê³„ë¥¼ ì†ì´ì§€ ì•ŠëŠ”ë‹¤. ğŸ˜)
        </p>
      </div>
    </section>

    {% if mode == "day" %}
      <!-- Day: Goals -->
      <section class="card">
        <div class="cardHead">
          <h2>ëª©í‘œ</h2>
          <span class="pill">Day</span>
        </div>

        <div class="list">
          {% for g in goals %}
            <div class="row between">
              <span class="{{ 'done' if g.done==1 else '' }}">{{ g.title }}</span>
              <span class="badge">{{ "DONE" if g.done==1 else "TODO" }}</span>
            </div>
          {% endfor %}
          {% if goals|length == 0 %}
            <p class="muted small">ì´ ë‚ ì§œì—ëŠ” ëª©í‘œ ê¸°ë¡ì´ ì—†ë‹¤.</p>
          {% endif %}
        </div>
      </section>

      <!-- Day: Sessions -->
      <section class="card">
        <div class="cardHead">
          <h2>ì„¸ì…˜</h2>
          <span class="pill">Day</span>
        </div>

        <div class="list">
          {% for s in sessions %}
            <div class="row between">
              <span class="muted small mono">{{ s.start_ts }} â†’ {{ s.end_ts }}</span>
              <b>{{ s.minutes }}ë¶„</b>
            </div>
          {% endfor %}
          {% if sessions|length == 0 %}
            <p class="muted small">ì´ ë‚ ì§œì—ëŠ” ì„¸ì…˜ ê¸°ë¡ì´ ì—†ë‹¤.</p>
          {% endif %}
        </div>
      </section>

      <!-- Day: Distractions -->
      <section class="card">
        <div class="cardHead">
          <h2>ë°©í•´ìš”ì†Œ</h2>
          <span class="pill">Day</span>
        </div>

        <div class="list">
          {% for d in distractions %}
            <div class="row between">
              <span class="muted small mono">{{ d.ts }}</span>
              <span>{{ d.note }}</span>
            </div>
          {% endfor %}
          {% if distractions|length == 0 %}
            <p class="muted small">ì´ ë‚ ì§œì—ëŠ” ë°©í•´ìš”ì†Œ ê¸°ë¡ì´ ì—†ë‹¤.</p>
          {% endif %}
        </div>
      </section>

    {% else %}
      <!-- Week: Table -->
      <section class="card" style="grid-column: 1 / -1;">
        <div class="cardHead">
          <h2>ìµœê·¼ 7ì¼</h2>
          <span class="pill">Week</span>
        </div>

        <div class="weekTable">
          <div class="weekRow weekHead">
            <div>ë‚ ì§œ</div>
            <div>ì§‘ì¤‘(ë¶„)</div>
            <div>ì„¸ì…˜</div>
            <div>ë°©í•´</div>
            <div>ëª©í‘œ</div>
            <div>ì™„ë£Œìœ¨</div>
          </div>

          {% for r in week_rows %}
            <div class="weekRow">
              <div class="mono">{{ r.date }}</div>
              <div><b>{{ r.focus_min }}</b></div>
              <div>{{ r.session_count }}</div>
              <div>{{ r.distractions }}</div>
              <div>{{ r.goal_done }}/{{ r.goal_total }}</div>
              <div>
                <div class="progressBar small">
                  <div class="progressFill" style="width: {{ r.goal_pct }}%"></div>
                </div>
                <span class="muted small">{{ r.goal_pct }}%</span>
              </div>
            </div>
          {% endfor %}
        </div>

        <p class="muted small" style="margin-top:10px;">
          íŒ: ì£¼ê°„ ì™„ë£Œìœ¨ì€ â€œì£¼ê°„ ëª©í‘œ í•©ì‚° ê¸°ì¤€â€ìœ¼ë¡œ ê³„ì‚°í•œë‹¤. (í•˜ë£¨ ëª©í‘œ ìˆ˜ê°€ ë‹¬ë¼ë„ ê³µì •)
        </p>
      </section>
    {% endif %}
  </main>
</body>
</html>
